# 一覧参照
![](images/2023-08-25-17-09-58.png)

## 内容
条件(氏名)を入力し絞り込みをクリックすることで条件抽出を行い一覧に表示します。

基本ですが、応用として他プログラムからコールされる選択プログラムに使ったり、ここから編集画面へ飛んだりと使えます。


## タスク構造
![](images/2023-08-25-17-25-26.png)

### タスク説明

#### MSyain

条件を入力、ボタン押下でLISTをリロード

#### LIST

条件に従って一覧を表示


## MSyain

タスク特性

![](images/2023-08-25-17-43-45.png)

タスクタイプ：WebClient

![](images/2023-08-25-17-49-29.png)

更新確認：No

![](images/2023-08-25-17-53-25.png)

ルート：MSyain

これで http://xxxxxxx/MSyain でアクセスできます。

![](images/2023-08-25-17-57-51.png)

トランザクションモード：なし

空のでデータビュー許可：No

## データビュー

![](images/2023-08-25-19-43-24.png)

## ロジック

V.名称に入力してBSELECTボタンを押すと

![](images/2023-08-25-19-44-24.png)

サブフォームを再表示します。

## フォーム

![](images/2023-08-25-19-51-57.png)

### サブフォームのプロパティ

![](images/2023-08-25-20-10-29.png)


## LIST

### タスク特性

![](images/2023-08-25-21-54-43.png)

一覧参照なので照会モード

![](images/2023-08-25-21-56-37.png)

更新がないのでトランザクションモード：なし

空のデータビュー許可：Yes

事前読込：Yes




### データビュー

![](images/2023-08-25-20-19-27.png)

M社員マスタをメインソースとして指定

名称の範囲としてパラメータのPi名称を使用して**Trim(Pi名称)&'*'**と前方一致で指定を行う。

パラメーターは**MSyainタスクの名称**と連携を取っている。

### フォーム

![](images/2023-08-25-21-57-38.png)

テーブルはマテリアルデザイングリッド

サーバー先行読込:True

## 選択プログラム

例えば社員コードでズームし、社員マスタを表示、選択して戻り値を渡す場合は

### MSyainタスク

![](images/2023-08-25-22-54-08.png)

受け取り、渡しパラメーターを設定します。

### LISTタスク

![](images/2023-08-25-23-01-28.png)


選択テーブルをYesにする

![](images/2023-08-25-23-05-07.png)

ボタンをクリックすることで選択したことにします。

![](images/2023-08-25-23-11-47.png)

選択テーブルをYesにしたことで、選択するとプログラムを終わろうとします。つまりレコ後を通るのでMSyainのPioParamを社員コードの値で項目更新します。

## 複雑な条件設定

条件が単純なAND文程度であれば範囲にて行えるのですが複雑な場合はSQLを構築する場合が多いです。


![](images/2023-08-28-11-13-10.png)

メインソースをSQLコマンドに変更いたします。

![](images/2023-08-28-11-32-07.png)

SQLには

```
SELECT 得意先コード,得意先名
FROM 得意先マスタ
WHERE 得意先コード = 得意先コード
:1
:2
```
と記述されています。そしてこの:1や:2を入力パラメータとして指定いたします。

:1には

```
if(B=3,' or 得意先ｺｰﾄﾞ = ' & ASCIIChr(39) & TRIM(A) & ASCIIChr(39),'')
```

:2には

```
if(C=3,' or 得意先名 LIKE %' & ASCIIChr(39) & TRIM(A) & '%' & ASCIIChr(39),'')
```

といったようにあいまい検索やSQLのWHERE句を積み重ねています。

戻り値には
SELECTの位置と変数があうように設定します。


## SQLコマンドはストアドプロシージャも可能
EXEC ? = TEST2 :1

例として以下のストアドプロシージャの戻り値を設定することも可能です。

```
ALTER PROCEDURE [dbo].[TEST2] 
@aaa nvarchar(30)
AS
BEGIN
      SET NOCOUNT ON;
      SELECT 得意先ｺｰﾄﾞ,得意先名1 FROM M得意先マスタ WHERE 得意先名1 LIKE '%'+ @aaa + '%' ;
END
```